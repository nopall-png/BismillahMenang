<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Deteksi Wajah - Ujian</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    .warning-banner { display: none; }
  </style>
</head>
<body class="bg-dark text-white">
  <div class="container mt-4">
    <h2 class="mb-3">üß† Deteksi Wajah Saat Ujian</h2>

    <!-- Kamera di pojok kiri atas, ukuran lebih kecil -->
    <div class="row">
      <div class="col-md-4">
        <img src="{{ url_for('video_exam') }}" width="320" height="240" class="border border-light rounded">
        <!-- Warning di bawah kamera, posisi tetap dalam layout -->
        <div id="warning" class="warning-banner alert alert-danger mt-2 p-2">
          <div><strong>‚ö†Ô∏è Peringatan:</strong> Anda meninggalkan halaman ujian / membuka tab baru.</div>
          <div class="small">Terhitung pelanggaran: <span id="warnCount">0</span></div>
        </div>
      </div>
    </div>

    <!-- Soal dummy tetap di bawah -->
    <div class="row mt-4">
      <div class="col-md-8">
        <div class="card bg-secondary text-white">
          <div class="card-header">Soal Contoh</div>
          <div class="card-body">
            <form id="dummyForm">
              <div class="mb-3">
                <label class="form-label">1) Ibu kota Indonesia adalah...</label>
                <div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="Jakarta" required>
                    <label class="form-check-label" for="q1a">Jakarta</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="Bandung">
                    <label class="form-check-label" for="q1b">Bandung</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="Surabaya">
                    <label class="form-check-label" for="q1c">Surabaya</label>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">2) 2 + 3 √ó 4 = ...</label>
                <div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="14" required>
                    <label class="form-check-label" for="q2a">14</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="20">
                    <label class="form-check-label" for="q2b">20</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="24">
                    <label class="form-check-label" for="q2c">24</label>
                  </div>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Kirim Jawaban</button>
              <a href="/" class="btn btn-outline-light ms-2">‚¨ÖÔ∏è Kembali</a>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const warningEl = document.getElementById('warning');
    const warnCountEl = document.getElementById('warnCount');
    let warnCount = 0;
    let allowUnload = false;

    function showWarning() {
      warnCount += 1;
      warnCountEl.textContent = warnCount;
      warningEl.style.display = 'block';
    }
    function hideWarning() {
      warningEl.style.display = 'none';
    }

    // Deteksi keluar tab / jendela tidak fokus
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) { showWarning(); }
      // Saat kembali fokus, biarkan banner tetap terlihat
    });
    window.addEventListener('blur', () => { showWarning(); });
    window.addEventListener('focus', () => { warningEl.style.display = 'block'; });

    // Deteksi pembuatan tab/jendela baru via shortcut (Ctrl/Cmd+T, Ctrl/Cmd+N)
    document.addEventListener('keydown', (e) => {
      const key = (e.key || '').toLowerCase();
      if ((e.ctrlKey || e.metaKey) && (key === 't' || key === 'n')) {
        showWarning();
      }
    });

    // Peringatan saat user mencoba meninggalkan halaman (navigate/close)
    const beforeUnloadHandler = (e) => {
      if (allowUnload) { return; }
      showWarning();
      e.preventDefault();
      e.returnValue = '';
    };
    window.addEventListener('beforeunload', beforeUnloadHandler);
    window.addEventListener('pagehide', () => { showWarning(); });

    // Dummy submit handler (contoh: izinkan unload jika perlu)
    document.getElementById('dummyForm').addEventListener('submit', (e) => {
      e.preventDefault();
      alert('Jawaban terkirim. Ini hanya contoh.');
      // Contoh: mengizinkan keluar selama 5 detik setelah submit
      allowUnload = true;
      setTimeout(() => { allowUnload = false; }, 5000);
    });
  </script>
</body>
</html>
